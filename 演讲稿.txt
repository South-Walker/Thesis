老师同学们大家好，我是来自药学152班的肖力铭，我毕业论文的题目是化合物发育毒性预测模型构建，基于神经网络算法与TensorFlow平台构建的发育毒性预测模型

翻页

下面我将按照课题综述、数据收集、数据描述、模型构建、模型评价的顺序介绍我的工作

翻页

首先是课题综述部分

翻页

具有发育毒性的化合物大体上指的是能够影响生物的发育过程，并且在生物发育过程中会表现出不良特性的化合物。
我们要探索对化合物发育毒性的虚拟预测方案的原因是传统的对药物发育毒性的评估方法主要是动物实验，而动物实验普遍具有开销大，耗材多，时间久的缺点。

翻页

然后是数据收集部分

翻页

本次实验的样本数据集可以分为毒性化合物与无毒化合物两个部分，
本实验的毒性化合物数据全部来自于中科院上海有机所物质毒性数据库。使用自制的脚本从目标网站爬取了合计22710种具有发育毒性潜力的化合物。由于发育毒性范围广泛，影响终点过多，难以一概而论。故选取了其中能够导致新生儿骨骼系统发育异常的1455种化合物作为有毒化合物数据集。
无毒化合物数据来自于实验室留存的数据集，大致按照1比1的原则选取了1273种无毒化合物与筛选后的有毒化合物组成了合计包含2736种化合物的化合物样本数据集。（有毒1463个）

翻页

一般的，利用机器学习算法构建的模型的泛化能力与样本在样本空间的分布有很大关系，通常，样本在样本空间分布的越均匀，模型的泛化能力就会越强。因此，有必要对样本空间的丰富度进行评估，通过化合物数据中的分子量与计算得到的脂水分配系数两个属性张成样本空间，并以此作图得到左图。可以看出阴性与阳性数据在利用分子量与脂水分配系数建立的化学空间中分布都较为广泛，且重叠度较高，可以说明本实验的数据来源代表性较强，具有足够广的化学空间分布，构建的模型泛化能力有所保障。

翻页

接下来是数据描述部分

翻页

数据描述部分工作主要分为5个步骤
（步骤一）首先是从有机所爬下的原始数据中提取出毒性化合物的smiles，
（步骤二）由于得到的smiles不完全符合规范部分smiles可能难以计算分子指纹与分子描述符，所以进行了筛选，（抬头）这里具体操作实际上是走了一点弯路，因为直接对smiles筛选会非常困难，所以是借助OpenBabel转换为了MOL格式，无法转换的则被丢弃。
（步骤三）之后将获得的结构信息输入PaDEL-Descriptor软件，借助其计算出化合物的多种分子指纹
（步骤四）下一步是筛选描述符，PaDEL-Descriptor软件总共提供797种分子描述符，在实际操作中假若计算某个分子的描述符时出现了非法值，该描述符会被删除，随后对计算出的描述符用自制的脚本进行归一化处理，归一化的具体算法是用计算值与该分量最小值的差除于该分量下最大值与最小值的差，之后计算所有分量的方差，方差过大的剔除，合计剔除了70项分子描述符
（步骤五）利用自制的脚本将化合物的分子描述符与分子指纹信息结合，输出Tab格式文件以满足预评估需要

翻页

数据描述部分的关键难点在于如何去选取合适的分子指纹。具体的选择是基于本人科研训练期间的课题内容的，当时使用了表中的五种分子指纹来预测化合物的水生生物毒性。
从左图中，可以看出在所有预测模型中，基于神经网络与随机森林算法构建的模型在性能上都有显著优势，期待进一步评估决定。
而在所有的分子指纹中，MACCSFP指纹与FingerPrinter指纹具有更好的表现，然而实际使用MACCSFP指纹进行建模是，我们发现使用其建模时很容易出现过拟合问题，这很可能是由于该指纹包含的数据分量较少，仅有166个分量。故最终选取FingerPrinter指纹描述数据。

翻页

下一阶段是模型构建阶段

翻页

在模型构建的第一步，要先确定模型使用的算法，具体的方案是分别对基于多种机器学习方法构建的模型的性能进行预评估，由于评估的算法过多，若全部实现工作量过大，于是使用了Orange软件。

翻页

Orange软件本身带有图形界面，具有简单、方便、易上手的特点，因此本课题选择Orange对多种机器学习算法进行预评估，后续建模步骤再使用自制的脚本进行开发。
根据上表所示的评估结果，可以看出，在数据使用FingerPrinter分子指纹描述的前提下，基于神经网络算法建立的模型具有较好的性能。

翻页

接下来是初步建模阶段，基于预评估决定的分子指纹与机器学习算法初步构建化合物发育毒性预测模型并评估其性能。

翻页

基于预评估所决定的描述方法在TensorFlow平台上使用自制的脚本初步构建了化合物发育毒性预测模型，具体的模型示意图如左。其中隐含层包含500个节点。初步评估其性能如下图，其有严重的过拟合趋势，以至于在迭代末期测试集Loss值甚至不收敛。实际的AUC值在表现最好的情况下也只有约0.65

翻页

因此，需要对构建的模型进行优化。

翻页

在实际的优化过程中，初步构建的模型暴露出的准确度不高、过拟合问题严重，损失函数难以收敛三个方面的问题对症下药，使用了对应的三套方案来优化模型。
模型准确度不高的原因可能是由于样本信息采集的太少，因此可以调整模型结构，补充化合物的分子描述符信息。
过拟合严重可以通过在损失函数中加入对复杂模型的惩罚的形式来降低模型的泛化误差，具体使用了正则化算法
损失值难以收敛的问题可以使用随机失活算法，在训练过程中随机的删除节点，来防止损失函数波动太过剧烈，从而得到改善

翻页

首先讲解提高模型准确度的方法，即加入分子描述符信息
在初步建立的模型的基础上加入描述符信息的方法有很多，其中非常典型的有左右两种，二者的区别在于描述符信息对应的深度
在实际上二者之间性能差异很小，最终考虑到分子指纹与描述符是两套描述化合物性质的规则，将二者拆分在两个层级可以先进行同一规则内部单独的特征分析，再进行交叉分析。且分子指纹作为一套完整的规则，是难以筛选的，可能存在化合物在某一系列分量上的表现近似相同，然而分子描述符是经过自制脚本筛选的，无效或离散程度较小的分量已经被提前筛除，其特征应该较分子指纹明显，故选择了方案二。

翻页

随后是减低过拟合程度的算法，使用的是正则化约束，其基本思想是对过于复杂的拟合模型在计算损失函数时给予惩罚。本模型之所以可以使用正则化约束进行优化的一个大前提是在描述数据时对数据进行了归一化处理，导致对模型具有相似程度描述能力的节点权重大小相似。具体而言，本课题使用的是L2算法进行的正则化约束，具体为正则率乘以权重的平方和，正则率具体的取值为0.05.
从图中可以对比看出使用正则化约束后模型的过拟合程度得到了显著降低

翻页

最后是稳定损失值的算法，使用的随机失活算法，其原理是指定一个保持率，然后在每次训练中，都只会有这一比例的的节点被训练，在本实验中，单纯只对最后一层隐含层使用了随机失活。保持率为0.75
随机失活算法对于本次实验预测模型有着一定程度上的优化，在模型迭代训练的后期，使用随机失活算法的模型测试集的Loss值会具有更小幅度的波动，Auc值也得到了提升。
还有一个没有反映在图表中的优化是使用随机失活后模型的训练速度得到了显著提高，其原因应该是每代迭代过程中都会有一部分节点因为失活而没有参与训练。

翻页

使用了上述所有优化算法后，得到了一个针对本次学习任务的最优实践模型，接下来要对模型进行评估

翻页

本实验将考虑使用分类准确性CA值与Roc曲线下方面积大小AUC值对所建模型进行评估。

翻页

出表

具体的评估方法使用留出法，每次训练前随机留出30%的样本作为测试集，只使用另外70%的样本训练模型。累计进行5次随机划分，取5次评估结果的均值作为结果。具体结果如下表。

出图

上图是根据最佳实践的预测模型在某次随机划分训练过程中获得的数据制作的。可以明显的看出本实验建立的预测模型具有一定程度上的学习性能，基于最佳实践算法建立的模型在收敛速度与收敛效果上都有较好表现，过拟合问题得到明显改善。可以在一定程度上正确预测化合物的发育毒性潜力。

翻页
翻页
我的演讲完了
致谢